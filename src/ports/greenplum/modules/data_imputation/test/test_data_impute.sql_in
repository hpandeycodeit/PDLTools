------------------------------------------------------------------------------------------------
-- File: test_data_imputation.sql_in
-- Unit test for data_imputation.sql_in
------------------------------------------------------------------------------------------------

-- Create a test dataset. 
CREATE  TABLE PDLTOOLS_SCHEMA.test_impute_demo(
		id int, 
		v1 double precision, 
		v2 double precision, 
		label text
);

INSERT INTO PDLTOOLS_SCHEMA.test_impute_demo VALUES 
(1 , 2.4 , 3.5 , 'a'),
(2 ,NULL, 2.5 , 'a'),
(3 , 1.2 , 3.0 , 'c'),
(4 , NULL, 5.1 , 'b'),    
(5 , 4.1 ,NULL, 'b'),
(6 , 3.9 ,NULL, 'b'),
(7 , NULL,NULL, 'a'),
(8 , 2.5 , 2.9 , 'd'),
(9 ,NULL, 1.2 , 'd'),
(10, 4.3 ,NULL, 'c');


-- count number of records in the output table

select assert(count(*), 1)  from PDLTOOLS_SCHEMA.impute_missing_values('PDLTOOLS_SCHEMA.test_impute_demo',ARRAY['id'],'id','label',FALSE,'PDLTOOLS_SCHEMA.out_imputed_data');


-- Clean up tables.
DROP TABLE  if exists PDLTOOLS_SCHEMA.test_impute_demo;
DROP TABLE  if exists PDLTOOLS_SCHEMA.out_imputed_data;
